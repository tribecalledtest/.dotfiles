#!/bin/bash

# A script to update all Go commands installed in the GOBIN directory.

# Get the GOBIN path, handling cases where it's not set.
gobin_path="${GOBIN:-$GOPATH/bin}"

# Check if the GOBIN directory exists.
if [ ! -d "$gobin_path" ]; then
  echo "The directory $gobin_path does not exist. No Go commands to update."
  exit 0
fi

echo "Updating all Go commands in $gobin_path..."

# Use a temporary file to hold unique module paths
declare -a module_paths

# Find all executable files and get their module paths.
find "$gobin_path" -maxdepth 1 -type f -print0 | while IFS= read -r -d '' file; do
  if [ -x "$file" ]; then
    # Use 'go version -m' and awk to reliably extract the module path.
    module_path=$(go version -m "$file" 2>/dev/null | awk '/path/{print $2; exit}')

    echo "Updating $module_path"
    go install "$module_path"@latest
  fi
done

echo "Update process complete."
